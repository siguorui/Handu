!function(){!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c){var d=!0;try{a.setItem(b,c)}catch(e){d=!1}return d}function e(a){this.journeyId=a,this.storage=window.localStorage}var f="storage";e.prototype.init=function(a){var b=this,c={};return b.callback=a,b.isSupported=b.isSupported(),b.isSupported&&(c=b.getJourneyItems(),window.addEventListener(f,b,!1)),c},e.prototype.handleEvent=function(a){var b,c=new RegExp("^"+this.journeyId+"\\.");a=a||window.event,a.type===f&&c.test(a.key)&&(b=this.getJourneyItems(),"function"==typeof this.callback&&this.callback(b))},e.prototype.isSupported=function(){var a=!1,b="test";try{this.storage.setItem(b,b),this.storage.removeItem(b),a=!0}catch(c){}return a},e.prototype.setItem=function(a,b){var c,e=!1;return this.isSupported&&(c=JSON.stringify(b),e=d(this.storage,this.journeyId+"."+a,c)),e},e.prototype.tryParse=function(a,b){try{return JSON.parse(a)}catch(c){if("SyntaxError"!==c.name)throw c;d(this.storage,b,JSON.stringify(a))}return a},e.prototype.getItem=function(a){a=this.journeyId+"."+a;var b=this.storage.getItem(a);return this.tryParse(b,a)},e.prototype.getJourneyItems=function(){var a,b,c,d,e={},f=new RegExp("^"+this.journeyId+"\\.");if(this.isSupported)try{for(d=this.storage.length,e={},b=0;b<d;b++)a=this.storage.key(b),f.test(a)&&(c=this.storage.getItem(a),e[a.replace(f,"")]=this.tryParse(c))}catch(g){e={}}return e},e.prototype.removeItem=function(a){this.isSupported&&this.storage.removeItem(this.journeyId+"."+a)},b.exports=e},{}],2:[function(a,b,c){"use strict";function d(a,b,c){"string"!=typeof b&&(b=JSON.stringify(b)),a.postMessage(b,c)}function e(a,b){var c,d,e={},f=new RegExp("^"+b);for(c in a)f.test(c)&&(d=c.replace(f,""),e[d]=a[c]);return e}function f(a,b,c){var d=b.value,e=a.getItem("sessionId"),f=e===c;f&&b.hasOwnProperty("value")&&b.hasOwnProperty("key")&&a.setItem(c+"."+b.key,d)}function g(a,b,c){b.hasOwnProperty("key")&&a.removeItem(c+"."+b.key)}function h(a,b){this.iframeId=b,this.journeyId=a,this.parentUrl=document.referrer.replace(/^([a-z]*:\/\/[^\/]+).*$/,"$1")||"*"}var i=1,j=2,k=3,l=a("./SharedStorage");h.prototype.init=function(){this.sharedStorage=new l(this.journeyId),window.addEventListener("message",this,!1),d(window.parent,{id:this.iframeId,messageBody:"ready"},this.parentUrl)},h.prototype.checkExpiredSession=function(a){var b=this,c=new RegExp("^"+a.sessionId+"\\."),d=a.sessionId!==this.sessionId;return d&&(this.sharedStorage.setItem("sessionId",this.sessionId),Object.keys(a).forEach(function(a){c.test(a)&&b.sharedStorage.removeItem(a)})),d},h.prototype.updateParent=function(a){var b,c=a.sessionId,f=e(a,c+"\\.");c!==this.sessionId&&(f=null),b={id:this.iframeId,messageBody:f},d(window.parent,b,this.parentUrl)},h.prototype.handleEvent=function(a){var b,c,d,e=this;a=a||window.event;try{b=JSON.parse(a.data)||{}}catch(h){b={}}switch(b.command){case i:this.sessionId=b.sessionId,c=this.sharedStorage.init(function(a){return e.updateParent(a)}),d=this.checkExpiredSession(c),d&&(c=this.sharedStorage.getJourneyItems()),this.updateParent(c);break;case j:f(this.sharedStorage,b,this.sessionId);break;case k:g(this.sharedStorage,b,this.sessionId)}},b.exports=h},{"./SharedStorage":1}],3:[function(a,b,c){"use strict";function d(a){var b=window.location.search.match(new RegExp("[?&]"+a+"=([^&]*)(&?)","i"));return b?decodeURIComponent(b[1]):b}b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("./StorageCommunicator"),e=a("./getQueryParameter"),f=new d(e("journeyId"),e("iframeId"));f.init()},{"./StorageCommunicator":2,"./getQueryParameter":3}]},{},[4])}();